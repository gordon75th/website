<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>🌷 Anika's Love Garden</title>
  <link href="https://fonts.googleapis.com/css2?family=Pacifico&family=Quicksand&display=swap" rel="stylesheet">
  <link href="css/style.css" rel="stylesheet">
  <link href="https://fonts.googleapis.com/css2?family=Caveat&display=swap" rel="stylesheet">
  <!-- Firebase SDK -->
  <script src="https://www.gstatic.com/firebasejs/10.8.1/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.8.1/firebase-database-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.8.1/firebase-messaging-compat.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>
  <audio id="notification-sound" src="images/notification.wav" preload="auto"></audio>
  <audio id="heartbeatSound" src="sounds/heartbeat.mp3" preload="auto"></audio>
  <link rel="icon" href="/images/tulip.ico">




  <link rel="manifest" href="manifest.json" />
  <meta name="theme-color" content="#ffe0f0" />

</head>


<body>
  <div style="position: fixed; bottom: 10px; left: 10px; z-index: 999;">
  <button onclick="reloadWithLove()" class="note-btn">🔄 Reload with Love</button>
  </div>

  <div style="position: fixed; bottom: 10px; right: 10px; z-index: 999;">
  <button onclick="toggleRomanticMode()" class="note-btn">🌙 Romantic Mode</button>
</div>


  <div class="top-buttons">
    <a href="library.html">
      <button class="btn">
        <div class="wrapper">
          <p style="font-family: 'Pacifico', cursive; color: rgb(83, 3, 70);" class="text">Bookmark</p>

          <div class="flower flower1">
            <div class="petal one"></div>
            <div class="petal two"></div>
            <div class="petal three"></div>
            <div class="petal four"></div>
          </div>
          <div class="flower flower2">
            <div class="petal one"></div>
            <div class="petal two"></div>
            <div class="petal three"></div>
            <div class="petal four"></div>
          </div>
          <div class="flower flower3">
            <div class="petal one"></div>
            <div class="petal two"></div>
            <div class="petal three"></div>
            <div class="petal four"></div>
          </div>
          <div class="flower flower4">
            <div class="petal one"></div>
            <div class="petal two"></div>
            <div class="petal three"></div>
            <div class="petal four"></div>
          </div>
          <div class="flower flower5">
            <div class="petal one"></div>
            <div class="petal two"></div>
            <div class="petal three"></div>
            <div class="petal four"></div>
          </div>
          <div class="flower flower6">
            <div class="petal one"></div>
            <div class="petal two"></div>
            <div class="petal three"></div>
            <div class="petal four"></div>
          </div>
        </div>
      </button>
    </a>
  </div>

  <a href="quote.html" class="magic-bookmark">📖 This reminded me of you <3</a> <div class="container">

      <h1>Hi Anika 🌷</h1>

      <div id="tulip-container">
        <div class="tulip" onclick="showRandomTulipMessage(event)">🌷</div>
        <div class="tulip" onclick="showRandomTulipMessage(event)">🌷</div>
        <div class="tulip" onclick="showRandomTulipMessage(event)">🌷</div>

      </div>



      <div class="popup" id="popup-box"></div>

      <div class="reasons">
        <h2>100 Reasons Why I Love You 💕</h2>
        <div id="reasons-list"></div>
      </div>
      <div class="reasons">
        <h2>Time has passed... ⏳ </h2>
        <div class="container">
          <p id="time-since" style="font-size: 1.5rem; color: #c9184a;"></p>
          <!--<a href="typewriter.html" style="font-family: 'Pacifico', cursive; color: rgb(83, 3, 70);" class="text">✍️
            Love Letter</a><br>-->
          <br> <a href="stars.html" style="font-family: 'Pacifico', cursive; color: rgb(83, 3, 70);" class="text">🌌
            Stargazing</a>
          <br>
          <div id="heartbeatContainer" class="heartbeat-wrapper">
            <button id="heartbeatBtn">❤️ Hold for Heartbeat</button>
            <div id="heartbeatPulse" class="pulse-circle"></div>
            <p id="heartbeatMsg" class="heartbeat-msg">Press and hold to feel the beat...</p>
          </div>


        </div>
      </div>

      <div class="love-notes">
        <h2>Write a Little Love Note 💌</h2>
        <input class="noteFrom" id="noteFrom" placeholder="Name..." /> <br>
        <textarea id="noteInput"
          placeholder="Du kannst hier immer mit mit yappenn, auch wenn ich schlafe oder nicht da bin..."
          rows="4"></textarea> <br>
        <button class="note-btn" onclick="addNote()">Send 💌</button>





        <div id="notesDisplay"></div>
      </div>

      <div id="notification" class="notification" style="display: none;">
        <p>💌 New message!</p>
      </div>

      <div class="love-notes" style="margin-top: 50px;">
        <h2>💫 Chat with Future You</h2>
        <input class="noteFrom" id="futureFrom" placeholder="From (vllttt futuree Anika oder Maid?)" /> <br>
        <textarea class="noteFrom" id="futureInput" rows="4"
          placeholder="Write a message for Future You..."></textarea><br>
        <label style="font-family: 'Quicksand'; color: #c9184a;">Unlock Date:</label>
        <input type="date" id="unlockDate" class="noteFrom" /> <br>
        <button class="note-btn" onclick="addFutureMessage()">Send to the Future 💌</button>

        <div id="futureMessages" style="margin-top: 30px;"></div>
      </div>

      <div class="love-notes" style="margin-top: 60px;">
  <h2>📓 Private Journal</h2>
  <select id="journalOwner" class="noteFrom">
    <option value="anika">Anika's Journal</option>
    <option value="maid">Maid's Journal</option>
  </select> <br>
  <textarea class="noteFrom" rows="6" placeholder="Your secret thoughts..."></textarea><br>
  <button class="note-btn" onclick="saveJournal()">💾 Save Entry</button>
  <button class="note-btn" onclick="loadJournal()">📖 Load Entry</button>
</div>




      </div>
      <div class="carousel-container">
        <h2 class="carousel-title">More Memories 🥰</h2>
        <div class="carousel">
          <button class="carousel-btn left" onclick="scrollCarousel(-1)">‹</button>
          <div class="carousel-track" id="carouselTrack">
            <img src="images/ank (7).jpg" alt="memory 1" />
            <img src="images/ank (8).jpg" alt="memory 1" />
            <img src="images/ank (9).jpg" alt="memory 1" />
            <img src="images/ank (10).jpg" alt="memory 1" />
            <img src="images/ank (11).jpg" alt="memory 1" />
            <img src="images/ank (12).jpg" alt="memory 1" />
            <img src="images/ank (13).jpg" alt="memory 1" />
            <img src="images/ank (14).jpg" alt="memory 1" />
            <img src="images/ank (1).jpg" alt="memory 1" />
            <img src="images/ank (2).jpg" alt="memory 1" />
            <img src="images/ank (3).jpg" alt="memory 1" />
            <img src="images/ank (4).jpg" alt="memory 1" />
            <img src="images/ank (5).jpg" alt="memory 1" />
            <img src="images/ank (6).jpg" alt="memory 1" />
            <img src="images/bfr/img (12).jpg" alt="memory 1" />
            <img src="images/bfr/img (7).jpg" alt="memory 2" />
            <img src="images/bfr/img (8).jpg" alt="memory 3" />
            <img src="images/bfr/img (10).jpg" alt="memory 4" />
            <img src="images/bfr/img (11).jpg" alt="memory 5" />
            <img src="images/bfr/img (13).jpg" alt="memory 6" />
            <img src="images/bfr/img (14).jpg" alt="memory 6" />
            <img src="images/bfr/img (15).jpg" alt="memory 6" />
            <img src="images/bfr/img (16).jpg" alt="memory 6" />
            <img src="images/bfr/img (17).jpg" alt="memory 6" />
            <img src="images/bfr/img (18).jpg" alt="memory 6" />
            <img src="images/bfr/img (19).jpg" alt="memory 6" />
            <img src="images/bfr/img (20).jpg" alt="memory 6" />
            <img src="images/bfr/img (21).jpg" alt="memory 6" />
            <img src="images/bfr/img (22).jpg" alt="memory 6" />
            <img src="images/bfr/img (23).jpg" alt="memory 6" />
            <img src="images/bfr/img (24).jpg" alt="memory 6" />
            <img src="images/bfr/img (25).jpg" alt="memory 6" />
            <img src="images/bfr/img (26).jpg" alt="memory 6" />
            <img src="images/bfr/img (27).jpg" alt="memory 6" />
            <img src="images/bfr/img (1).jpg" alt="cute" />
            <img src="images/bfr/img (2).jpg" alt="bear" />
            <img src="images/bfr/img (3).jpg" alt="kitten" />
            <img src="images/bfr/img (5).jpg" alt="bear" />
            <img src="images/bfr/img (6).jpg" alt="kitten" />
            <img src="images/bfr/img (9).jpg" alt="bear" />
          </div>
          <button class="carousel-btn right" onclick="scrollCarousel(1)">›</button>
        </div>
      </div>

      <div class="floating-heart-container" id="floatingHeartContainer"></div>


      <div id="adminSection">
        <h2 onload="renderVisitLogs()">🛠️ Admin Panel</h2>

        <button onclick="archiveSelected()" class="note-btn">📁 Archive Selected</button>
        <button onclick="deleteSelectedArchived()" class="note-btn" style="background-color: #ffdddd;">🗑️ Delete
          Selected</button>
        <button onclick="exitAdminMode()" class="note-btn" style="background-color: #fff4f4; color: #a00;">🚪 Exit Admin
          Mode</button>


        <div id="archivedDisplay" style="margin-top: 30px;">
          <h3>📁 Archived Notes</h3>
        </div>



      </div>


      <div id="adminTrigger"
        style="position:fixed; bottom:5px; right:5px; font-size:10px; opacity:0.2; cursor:pointer;">
        admin
      </div>






      <script>
        const firebaseConfig = {
          apiKey: "AIzaSyDvrQH8cgKTa5naq_X-LRX2hKvwKPVdyPs",
          authDomain: "lovenotesforanika.firebaseapp.com",
          databaseURL: "https://lovenotesforanika-default-rtdb.europe-west1.firebasedatabase.app",
          projectId: "lovenotesforanika",
          storageBucket: "lovenotesforanika.firebasestorage.app",
          messagingSenderId: "955890146894",
          appId: "1:955890146894:web:458debbf68510359bd6d1f",
          measurementId: "G-Z0KZYDREQS"
        };

        firebase.initializeApp(firebaseConfig);
        const db = firebase.database();



        const popupBox = document.getElementById('popup-box');

        function showPopup(message) {
          const popupBox = document.getElementById('popup-box');
          popupBox.textContent = message;
          popupBox.classList.add('show');
          popupBox.style.display = 'block';

          // Clear old timeout if it's still running
          if (popupTimeout) clearTimeout(popupTimeout);

          // Set a new timeout
          popupTimeout = setTimeout(() => {
            popupBox.classList.remove('show');
            popupBox.style.display = 'none';
          }, 18000);
        }


        let vibrationInterval;
        let popupTimeout;
        let fastVibrationInterval;




        const tulipMessages = [
          "Your smile lights up my world ✨",
          "You’re my sunshine on cloudy days ☀️",
          "Being with you feels like home 🏡",
          "You’re my favorite kind of forever 💞",
          "You’re the reason love songs make sense 🎶",
          "My heart does a happy dance every time I think of you 💃",
          "You + Me = Always meant to be 🧸",
          "I still get butterflies when I see your name pop up 💌",
          "You make the ordinary feel magical 🌟",
          "You are the love story I always wanted 📖💘",
          "Hugging you is my favorite hobby 🤗",
          "You're my safe place and my wildest adventure 🌍",
          "You’re my best decision. Ever. 💯",
          "You turn my cloudy days into sparkly skies 🌈",
          "Falling for you is my favorite free fall 💗"
        ];

        function showRandomTulipMessage(event) {
          const msg = tulipMessages[Math.floor(Math.random() * tulipMessages.length)];
          showPopup(msg);

          if (event?.target?.classList) {

            event.target.classList.add('blooming');
            setTimeout(() => {
              event.target.classList.remove('blooming');
            }, 600);
          }
        }



        const messaging = firebase.messaging();

        function requestNotificationPermission() {
          Notification.requestPermission().then((permission) => {
            if (permission === "granted") {
              messaging.getToken({
                  vapidKey: "BHyJvAdi4CH02Owikax9kDnAbs4iA7jlJE5v8WT9lsKbo_ejCjuUZPkcEA3pmIXwtVtuIYZmQcpKGI7iz58Z1bY"
                })
                .then((currentToken) => {
                  if (currentToken) {
                    console.log("Token received:", currentToken);

                    // 💾 Save the token to Firebase
                    db.ref("notificationTokens/anika").set(currentToken);
                  } else {
                    console.warn("No token available.");
                  }
                })
                .catch((err) => {
                  console.error("Token retrieval error:", err);
                });
            } else {
              console.warn("Permission not granted.");
            }
          });
        }


        document.getElementById("adminTrigger").addEventListener("click", () => {
          const pass = prompt("🔐 Enter the Admin password:");
          if (pass === "hubert") {
            sessionStorage.setItem("admin", "true");
            document.getElementById("adminSection").style.display = "block";
            document.body.classList.add("admin-mode");
            renderNotes();
            renderArchivedNotes();
            loadFutureMessages();
            alert("✅ Admin Mode Activated!");
          } else {
            alert("❌ Wrong password!");
          }
        });



        const reasons = [
          'I love how you always listen to me when I have to yaaaapp',
          'I love how your hugs make the world around me stop',
          'I love how you are always on my side, no matter what',
          'I love our little "arguments" make my day always a tiny bit better',
          'I love how I always get a smile on my face when you try to pay for small things',
          'I love how you make me feel like I deserve to be loved',
          'I love how you are always there when I need you the most',
          'I love your reactions to my "foltern"',
          'I love the way you laugh at my dumb jokes',
          'I love the way you use emotional manipulation to make me melt',
          'I love how you try gaslighting me, even though you know what you said..',
          'I love the cute litte reels you send me each and every day, please never stop',
          'I love your podcasts and voice messages that make my day just a bit brighter..',
          'I love hearing about your life and whats going on when Im not there',
          'I love our gossip sessions where we judge other people',
          'I love hearing about whats going on at your school and how you want to punch people in the face',
          'I love hearing your random ADHS stories and decicions you make throughout the day always bring a smile to my face',
          'I love how youre there for other people, even though youre not always in the best mood',
          'I love how you try to make others laugh and feel better, even when youre not a 100% yourself',
          'I love how you always get so lost talking about your books, your beauty makes me fall in love more each day',
          'I love the person that I am, when Im with you',
          'I love how you make me want to give my best, each and every day',
          'I love scrolling on my phone or being out with friends and seeing stuff that reminds me of you',
          'I love how you care so much about me and your friends',
          'I love every moment between us, the loudest laughs and the quietest silences',
          'I love how I can trust you with everything in my life',
          'I love how you change every enviroment youre in, making it not the same without you there',
          'I love how youre there when I need someone to talk to',
          'I love how you always know how to cheer me up',
          'I love how you listen to little things I say to you, and remember them',
          'I love how sassy we get together when talking about other people',
          'I love your randomness sometimes, brining a smile to my face all the time',
          'I love opening my phone or wallet and seeing your picture there, makes me smile even if Im feeling shiiittt <3 ',
          'I love seeing you in my hoodies, tshirts or generally showing off anything I give you',
          'I love your touch, It makes me freeze up and melt at the same time',
          'I love how you show off were together, especially around others or in public',
          'I love holding your hand while walking down the street, showing youre mine and Im yours',
          'I love how we get to laugh at the same dumb humour',
          'I love how we both get jokes nobody else does',
          'I love how we always think "wrong" and "dirty" after someone said something that could be missunderstood',
          'I love how risky we get with each other sometimes, even though a bit more wouldnt hurt',
          'I love spending time with you, hating the moment I have to say goodbye',
          'I love being lost in your arms',
          'I love laying in your lap by the sea, you caressing my hair, a perfect moment with THE perfect person',
          'I love your energy',
          'I love your pure heart',
          'I love how unique you are, your voice, eyes, everything being Einzig-Artig und einfach wow..',
          'I love the unforgetable smell of your parfume',
          'I love the most amazing taste of your lips',
          'I love how you made me believe in "forever" again',
          'I love how you dont treat me as an option, but your one and only',
          'I love how you fix my hair, clothes or remove something that falls onto my face',
          'I love how you cant make me angry at you',
          'I love the dreams I have about you each night',
          'I love the way you fake being mad at me just to get extra kisses',
          'I love how you try to win arguments with guilt trips (and it works)',
          'I love how I get butterflies even from your smallest texts',
          'I love that we always stay up together, even though were both sleepyyy',
          'I love how you wear my hoodie and act like its yours now (it kinda is)',
          'I love how we somehow end up cuddling during serious conversations',
          'I love how you pull me closer like Im your personal pillow',
          'I love how you pretend youre not needy but the cuddles say otherwise',
          'I love how you give me "the look" and I instantly know whats up',
          'I love how your kisses make me forget what I was mad about',
          'I love the way you whisper things in my ear and make me blush like crazy',
          'I love how you make even the most boring things feel like a fun date',
          'I love how we have our own secret language and jokes',
          'I love how your clinginess matches my neediness perfectly',
          'I love how your neediness matches my clinginess perfectly',
          'I love how you always know exactly how to push my buttons…',
          'I love how torturing you on feels like a superpower',
          'I love how we can flirt without saying a single word',
          'I love how you leave your scent on my clothes just to torture me',
          'I love how you pretend to be shy, then say the most chaotic things',
          'I love how you always end up next to me, no matter the situation',
          'I love how your teasing turns into full-blown seduction sometimes',
          'I love how we can go from sweet to spicy in 0.3 seconds',
          'I love how you randomly flash me with affection… or something else..',
          'I love how you know exactly where to touch me or what to say to calm me down',
          'I love how you make a simple kiss feel like a promise',
          'I love the look you give me when youre up to no good',
          'I love how you make me feel like the only person in the room',
          'I love how you take care of me like a partner, not just a lover',
          'I love how you always want "just a few more minutes" when were outside and both being late home',
          'I love how you make even silence feel intimate',
          'I love the way you get all snuggly and warm when youre sleepy',
          'I love how you make fun of me but still adore me endlessly',
          'I love how you touch my body and face when we kiss, it makes me melt',
          'I love how we can have an entire conversation with just eye contact',
          'I love how you sometimes act like a brat just to get my attention',
          'I love how you always make me want to be touching or holding you somehow',
          'I love how we talk about the future like its already ours',
          'I love how we both get to laugh over ugly images and stickers from each other',
          'I love how our personality types match up perfectly (ENFJxINTP 🔛🔝)',
          'I love our phone calls that feel like they last 10 minutes and not three hours..',
          'I love our ability to roast each other for 30 minutes, then go to kissing in a second',
          'I love how we can talk about both nothing and everything all the time',
          'I love every second, minute, hour, day spent with you',
          'I love your eyes, smile, hair, body, humor, smell, style, voice. Everything about you.',
          'I love YOU, Anika.'

        ];

        const heartbeatBtn = document.getElementById('heartbeatBtn');
        const heartbeatPulse = document.getElementById('heartbeatPulse');
        const heartbeatMsg = document.getElementById('heartbeatMsg');
        const heartbeatSound = document.getElementById('heartbeatSound');

        let holdTimer;
        let longHoldTriggered = false;

        heartbeatBtn.addEventListener('mousedown', startHeartbeat);
        heartbeatBtn.addEventListener('touchstart', startHeartbeat);

        heartbeatBtn.addEventListener('mouseup', stopHeartbeat);
        heartbeatBtn.addEventListener('mouseleave', stopHeartbeat);
        heartbeatBtn.addEventListener('touchend', stopHeartbeat);

        function startHeartbeat() {
          heartbeatPulse.classList.add('pulse-active');
          heartbeatMsg.textContent = "This is how my heart beats when I think of you 💗";

          heartbeatSound.loop = true;
          heartbeatSound.volume = 0.4;
          heartbeatSound.play();

          if (navigator.vibrate) {
            navigator.vibrate([100, 30]); // initial kick
            vibrationInterval = setInterval(() => {
              navigator.vibrate([100, 30]); // slow beat
            }, 1000);
          }

          longHoldTriggered = false;
          holdTimer = setTimeout(() => {
            heartbeatMsg.textContent = "Wow.. ich habb diiichhh auch gaanz dolle lieebbb <33";
            longHoldTriggered = true;

            clearInterval(vibrationInterval); // Stop slow beat

            // Start faster beat
            fastVibrationInterval = setInterval(() => {
              navigator.vibrate([60, 20]);
            }, 500);

            navigator.vibrate([200, 100, 200, 100, 200]); // special pulse on trigger
          }, 10000);
        }


        function stopHeartbeat() {
          heartbeatPulse.classList.remove('pulse-active');
          heartbeatSound.pause();
          heartbeatSound.currentTime = 0;

          clearTimeout(holdTimer);

          if (vibrationInterval) {
            clearInterval(vibrationInterval);
            vibrationInterval = null;
          }
          if (fastVibrationInterval) {
            clearInterval(fastVibrationInterval);
            fastVibrationInterval = null;
          }

          if (!longHoldTriggered) {
            heartbeatMsg.textContent = "Press and hold to feel the beat...";
          }
        }




        function scrollCarousel(direction) {
          const track = document.getElementById('carouselTrack');
          const scrollAmount = 300;
          track.scrollBy({
            left: direction * scrollAmount,
            behavior: 'smooth'
          });
        }

        let startX = 0;
        let isDown = false;

        const carousel = document.getElementById('carouselTrack');

        carousel.addEventListener('touchstart', (e) => {
          startX = e.touches[0].clientX;
          isDown = true;
        });

        carousel.addEventListener('touchmove', (e) => {
          if (!isDown) return;
          const currentX = e.touches[0].clientX;
          const diff = startX - currentX;
          carousel.scrollLeft += diff;
          startX = currentX;
        });

        carousel.addEventListener('touchend', () => {
          isDown = false;
        });



        const list = document.getElementById('reasons-list');
        for (let i = 0; i < reasons.length; i++) {
          const div = document.createElement('div');
          div.className = 'reason';
          div.textContent = `${i + 1}. ${reasons[i]}`;
          list.appendChild(div);
        }

        function updateTimeSince() {
          const startDate = new Date("March 5, 2025 14:00:00");
          const now = new Date();
          const diff = now - startDate;

          const seconds = Math.floor(diff / 1000) % 60;
          const minutes = Math.floor(diff / (1000 * 60)) % 60;
          const hours = Math.floor(diff / (1000 * 60 * 60)) % 24;
          const days = Math.floor(diff / (1000 * 60 * 60 * 24));

          document.getElementById("time-since").textContent =
            `${days} days, ${hours} hours, ${minutes} minutes, ${seconds} seconds 💞`;
        }



        setInterval(updateTimeSince, 1000);
        updateTimeSince();

        function addNote() {
          const from = document.getElementById('noteFrom').value.trim();
          const text = document.getElementById('noteInput').value.trim();
          if (!text || !from) return;

          const timestamp = getFormattedDate();

          const newNote = {
            from,
            text,
            time: timestamp
          };

          db.ref("loveNotes").push(newNote);

          document.getElementById('noteInput').value = '';
          document.getElementById('noteFrom').value = '';

          confetti({
            particleCount: 100,
            spread: 70,
            origin: {
              y: 0.6
            }
          });

          showNotification(from);

          if (from.toLowerCase().includes("maidadmin")) {
            sessionStorage.setItem("admin", "true");
            document.getElementById("adminSection").style.display = "block";
            document.body.classList.add("admin-mode"); // ✅ add this line
            renderNotes();
          }

        }

        function manuallyArchiveOldNotes() {
          db.ref("loveNotes").once("value", (snapshot) => {
            const updates = {};
            const deletions = {};

            snapshot.forEach((child) => {
              const note = child.val();
              const key = child.key;

              // Archive everything, no matter how old
              updates[`/archivedNotes/${key}`] = note;
              deletions[`/loveNotes/${key}`] = null;
            });

            if (Object.keys(updates).length > 0) {
              db.ref().update({
                  ...updates,
                  ...deletions
                })
                .then(() => {
                  alert("🗃️ All current notes have been archived.");
                  renderArchivedNotes(); // Refresh archive display
                  renderNotes(); // Optionally clear live view
                  loadFutureMessages();
                })
                .catch((err) => {
                  console.error("Error archiving notes:", err);
                });
            } else {
              alert("📭 No notes found to archive.");
            }
          });
        }


        function renderArchivedNotes() {
          const display = document.getElementById('archivedDisplay');
          db.ref("archivedNotes").once("value", (snapshot) => {
            display.innerHTML = '<h3>📁 Archived Notes</h3>';
            const notes = snapshot.val();

            if (notes) {
              Object.entries(notes).forEach(([key, note]) => {
                const div = document.createElement('div');
                div.className = 'note archived';
                div.innerHTML = `
                ${yourAreAdmin() ? `<input type="checkbox" class="archive-checkbox" data-type="archivedNote" data-key="${key}">` : ''}
                <strong>${note.from}</strong> <em>(${note.time})</em><br>${note.text}
                <br><button onclick="restoreNote('${key}')">🔁 Restore</button>

              `;
                display.appendChild(div);
              });
            } else {
              display.innerHTML += "<p>No archived notes.</p>";
            }
          });
          // Now render archived future messages
          db.ref("archivedFutureMessages").once("value", (futureSnap) => {
            const futureMessages = futureSnap.val();

            if (futureMessages) {
              Object.entries(futureMessages).forEach(([key, msg]) => {
                const div = document.createElement('div');
                div.className = 'note archived future';
                div.innerHTML = `
                  ${yourAreAdmin() ? `<input type="checkbox" class="archive-checkbox" data-type="archivedFutureMessage" data-key="${key}">` : ''}
                  <strong>${msg.from}</strong> <em>(${msg.time})</em><br>
                  <i>Future Msg (Unlock on ${msg.unlockDate})</i><br>
                  ${msg.text}
                  <br><button onclick="restoreFutureMessage('${key}')">🔁 Restore</button>
                `;
                display.appendChild(div);
              });
            }
          });
        }

        function restoreFutureMessage(key) {
          db.ref(`archivedFutureMessages/${key}`).once("value", (snapshot) => {
            const msg = snapshot.val();
            if (!msg) return;

            db.ref(`futureMessages/${key}`).set(msg)
              .then(() => db.ref(`archivedFutureMessages/${key}`).remove())
              .then(() => {
                alert("🔁 Future message restored!");
                renderArchivedNotes();
                loadFutureMessages();
              })
              .catch((err) => {
                console.error("Restore error:", err);
              });
          });
        }


        function deleteSelectedArchived() {
          const checkboxes = document.querySelectorAll('.archive-checkbox:checked');
          if (checkboxes.length === 0) {
            alert("❌ No archived notes selected.");
            return;
          }

          if (!confirm("Are you sure you want to permanently delete these notes? This cannot be undone.")) return;

          const deletions = {};

          checkboxes.forEach((box) => {
            const key = box.dataset.key;
            const type = box.dataset.type;

            if (type === "archivedNote") {
              deletions[`archivedNotes/${key}`] = null;
            } else if (type === "archivedFutureMessage") {
              deletions[`archivedFutureMessages/${key}`] = null;
            }
          });

          db.ref().update(deletions)
            .then(() => {
              alert("🗑️ Selected archived notes deleted.");
              renderArchivedNotes(); // Refresh archive section
            })
            .catch((err) => {
              console.error("Error deleting archived notes:", err);
            });
        }



        function yourAreAdmin() {
          return sessionStorage.getItem("admin") === "true";
        }

        function showNotification(from) {
          const notification = document.getElementById('notification');
          const name = from.toLowerCase();

          let message = "";
          if (name.includes("anika")) {
            message = "🌷 A love note from Anika!";
          } else if (name.includes("maid") || name.includes("majd") || name.includes("dein vollidiot") || name
            .includes("your boy")) {
            message = "🧸 Dein Vollidiot left you a message!";
          } else {
            message = "💌 Neue Notification!";
          }

          notification.innerHTML = `<p>${message}</p>`;
          notification.style.display = 'block';

          setTimeout(() => {
            notification.classList.add('show');
          }, 10);

          setTimeout(() => {
            notification.classList.remove('show');
            setTimeout(() => {
              notification.style.display = 'none';
            }, 500);
          }, 5000);
        }






        function renderNotes() {
          const display = document.getElementById('notesDisplay');
          db.ref("loveNotes").on("value", (snapshot) => {
            display.innerHTML = '';
            const notes = snapshot.val();
            if (notes) {
              Object.entries(notes).forEach(([key, note]) => {
                const sender = note.from || "Someone";
                const time = note.time || "";

                const div = document.createElement('div');
                div.className = 'note';
                div.innerHTML = `
          ${yourAreAdmin() ? `<input type="checkbox" class="archive-checkbox" data-type="loveNote" data-key="${key}">` : ''}
          <strong>${sender}</strong> <em>(${time})</em><br>${note.text}
        `;
                display.appendChild(div);
              });
            }
          });
        }

        window.onload = () => {
          renderNotes(); // Always render notes
          loadFutureMessages(); // Always load future messages

          if (yourAreAdmin()) {
            document.getElementById("adminSection").style.display = "block";
            document.body.classList.add("admin-mode");
            renderArchivedNotes();
            renderVisitLogs();
          }
        };



        function logVisit() {
          const timestamp = new Date().toLocaleString();
          const visitorID = 'anika'; // You can change this if needed
          const visitRef = db.ref(`visits/${visitorID}`).push();

          // Define your desktop and phone user agents to exclude both
          const myUserAgentDesktop =
            "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/132.0.0.0 Safari/537.36 OPR/117.0.0.0";
          const myUserAgentVSC =
            "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Code/1.99.3 Chrome/132.0.6834.210 Electron/34.3.2 Safari/537.36"
          const myUserAgentPhone =
            "Mozilla/5.0 (Linux; Android 10; K) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/134.0.0.0 Mobile Safari/537.36 OPR/88.0.0.0";

          const userAgent = navigator.userAgent;

          // Only log if not admin and user agent is neither desktop nor phone
          if (!sessionStorage.getItem("admin") && userAgent !== myUserAgentDesktop && userAgent !== myUserAgentPhone &&
            userAgent !== myUserAgentVSC) {
            visitRef.set({
              time: timestamp,
              userAgent: userAgent
            });
          }
        }

        // Only log if not admin
        if (!sessionStorage.getItem("admin")) {
          logVisit();
        }

        function renderVisitLogs() {
          const display = document.createElement('div');
          display.innerHTML = `<h3>👀 Visit Log</h3>`;
          db.ref("visits/anika").once("value", (snapshot) => {
            const visits = snapshot.val();
            if (!visits) {
              display.innerHTML += "<p>No visits logged yet.</p>";
            } else {
              const anikaUserAgent =
                "Mozilla/5.0 (Linux; Android 10; K) AppleWebKit/537.36 (KHTML, like Gecko) SamsungBrowser/27.0 Chrome/125.0.0.0 Mobile Safari/537.36";

              const list = Object.values(visits)
                .sort((a, b) => new Date(b.time) - new Date(a.time))
                .map(v => {
                  const isAnika = v.userAgent === anikaUserAgent;
                  const label = isAnika ? `<span style="color: #c9184a;">👸 Anika ❤️</span>` : "";
                  return `<li>${v.time} ${label}<br><small style="color:#888;">${v.userAgent}</small></li>`;
                })
                .join("");

              display.innerHTML += `<ul style="text-align:left;">${list}</ul>`;
            }
            document.getElementById("adminSection").appendChild(display);
          });
        }





        function restoreNote(key) {
          db.ref(`archivedNotes/${key}`).once("value", (snapshot) => {
            const note = snapshot.val();
            if (!note) return;

            db.ref(`loveNotes/${key}`).set(note)
              .then(() => db.ref(`archivedNotes/${key}`).remove())
              .then(() => {
                alert("🔁 Note restored!");
                renderArchivedNotes();
                renderNotes();
              })
              .catch((err) => {
                console.error("Restore error:", err);
              });
          });
        }



        function getFormattedDate() {
          const now = new Date();
          const day = String(now.getDate()).padStart(2, '0');
          const month = String(now.getMonth() + 1).padStart(2, '0'); // Months are 0-based
          const year = now.getFullYear();
          const hours = String(now.getHours()).padStart(2, '0');
          const minutes = String(now.getMinutes()).padStart(2, '0');
          return `${day}/${month}/${year} ${hours}:${minutes}`;
        }



        const timestamp = new Date().toLocaleString();
        notes.push({
          from,
          text,
          time: timestamp
        });

        function fakeTypingEffect(text, element) {
          let i = 0;

          function type() {
            if (i < text.length) {
              element.innerHTML += text.charAt(i);
              i++;
              setTimeout(type, 40);
            }
          }
          type();
        }


        if ('serviceWorker' in navigator) {
          window.addEventListener('load', function () {
            navigator.serviceWorker.register('service-worker.js')
              .then(function (registration) {
                console.log('Service Worker registered with scope:', registration.scope);
              }).catch(function (error) {
                console.log('Service Worker registration failed:', error);
              });
          });
        }

        function addFutureMessage() {
          const from = document.getElementById('futureFrom').value.trim();
          const text = document.getElementById('futureInput').value.trim();
          const unlockDate = document.getElementById('unlockDate').value;
          const time = getFormattedDate();

          if (!text || !from || !unlockDate) return;

          const message = {
            from,
            text,
            unlockDate,
            time
          };

          db.ref("futureMessages").push(message);

          document.getElementById('futureFrom').value = '';
          document.getElementById('futureInput').value = '';
          document.getElementById('unlockDate').value = '';

          alert("💌 Message saved for the future!");
          loadFutureMessages();
        }

        function loadFutureMessages() {
          const container = document.getElementById('futureMessages');
          db.ref("futureMessages").on("value", (snapshot) => {
            container.innerHTML = '';
            const messages = snapshot.val();
            if (messages) {
              Object.entries(messages).forEach(([key, msg]) => {
                const div = document.createElement('div');
                div.className = 'note';

                const today = new Date();
                const unlock = new Date(msg.unlockDate);
                const isUnlocked = today >= unlock;

                if (!isUnlocked) div.classList.add('locked');

                const canView = isUnlocked || yourAreAdmin();

                div.innerHTML = `
                ${yourAreAdmin() ? `<input type="checkbox" class="archive-checkbox" data-type="futureMessage" data-key="${key}">` : ''}
                <strong>${msg.from}</strong> <em>(${msg.time})</em><br>
                ${canView
                  ? msg.text
                  : `🔒 This message is locked until <b>${msg.unlockDate}</b><div class="countdown">${getCountdown(unlock)}</div>`}
              `;


                container.appendChild(div);

                if (isUnlocked) {
                  div.style.opacity = 0;
                  setTimeout(() => {
                    div.style.transition = 'opacity 1s ease-in-out';
                    div.style.opacity = 1;
                  }, 100);
                }
              });
            }
          });
        }

        function exitAdminMode() {
          sessionStorage.removeItem("admin");
          document.getElementById("adminSection").style.display = "none";
          document.body.classList.remove("admin-mode");
          alert("👋 Admin Mode exited.");
        }



        function archiveSelected() {
          const checkboxes = document.querySelectorAll('.archive-checkbox:checked');
          const updates = {};
          const deletions = {};

          if (checkboxes.length === 0) {
            alert("📭 No notes selected.");
            return;
          }

          checkboxes.forEach((box) => {
            const key = box.dataset.key;
            const type = box.dataset.type;

            if (type === "loveNote") {
              const refPath = `loveNotes/${key}`;
              const archivePath = `archivedNotes/${key}`;
              db.ref(refPath).once("value", (snapshot) => {
                if (snapshot.exists()) {
                  updates[archivePath] = snapshot.val();
                  deletions[refPath] = null;
                }
                finalizeArchiving(updates, deletions);
              });
            } else if (type === "futureMessage") {
              const refPath = `futureMessages/${key}`;
              const archivePath = `archivedFutureMessages/${key}`;
              db.ref(refPath).once("value", (snapshot) => {
                if (snapshot.exists()) {
                  updates[archivePath] = snapshot.val();
                  deletions[refPath] = null;
                }
                finalizeArchiving(updates, deletions);
              });
            }
          });
        }

        function finalizeArchiving(updates, deletions) {
          if (Object.keys(updates).length === 0) return;

          db.ref().update({
              ...updates,
              ...deletions
            })
            .then(() => {
              alert("📁 Selected messages archived.");
              renderNotes();
              loadFutureMessages();
              renderArchivedNotes();
            })
            .catch((err) => {
              console.error("Archiving error:", err);
            });
        }


        function getCountdown(unlockDate) {
          const now = new Date();
          const diff = new Date(unlockDate) - now;

          if (diff <= 0) return "Unlocked soon!";

          const days = Math.floor(diff / (1000 * 60 * 60 * 24));
          const hours = Math.floor((diff / (1000 * 60 * 60)) % 24);
          const minutes = Math.floor((diff / (1000 * 60)) % 60);

          return `Unlocks in ${days}d ${hours}h ${minutes}m`;
        }

        window.addEventListener('scroll', () => {
          const heart = document.createElement('div');
          heart.className = 'floating-heart';
          heart.textContent = '💗';
          heart.style.left = Math.random() * window.innerWidth + 'px';
          heart.style.top = (window.scrollY + Math.random() * 50) + 'px';
          document.getElementById('floatingHeartContainer').appendChild(heart);

          setTimeout(() => {
            heart.remove();
          }, 4000);
        });

        function reloadWithLove() {
  confetti({ particleCount: 100, spread: 100, origin: { y: 0.7 } });

  const heart = document.createElement('div');
  heart.className = 'floating-heart';
  heart.textContent = '💖';
  heart.style.left = Math.random() * window.innerWidth + 'px';
  heart.style.top = '50%';
  document.getElementById('floatingHeartContainer').appendChild(heart);

  setTimeout(() => {
    location.reload();
  }, 1500);
}

function toggleRomanticMode() {
  const isOn = document.body.classList.toggle("romantic-mode");
  localStorage.setItem("romanticMode", isOn ? "on" : "off");
}

window.onload = () => {
  if (localStorage.getItem("romanticMode") === "on") {
    document.body.classList.add("romantic-mode");
  }

  // Existing initializers like renderNotes(), etc.
};

function saveJournal() {
  const owner = document.getElementById("journalOwner").value;
  const entry = document.getElementById("journalEntry").value;
  if (!entry) return alert("Write something first!");
  localStorage.setItem(`journal-${owner}`, entry);
  alert("✍️ Entry saved for " + owner.charAt(0).toUpperCase() + owner.slice(1));
}

function loadJournal() {
  const owner = document.getElementById("journalOwner").value;
  const saved = localStorage.getItem(`journal-${owner}`);
  document.getElementById("journalEntry").value = saved || "";
}




      </script>



</body>

</html>